name: "[A] files/list"

on:
  push:
    tags-ignore: [ '*' ]
    branches: [ 'master' ]
    paths:
      - .github/workflows/act-files-list.yaml

  workflow_dispatch:

jobs:
  test-list-files:
    runs-on: ubuntu-latest

    steps:
      - shell: bash
        run: |
          echo "my custom file contents" > ./test-file-1.txt
          echo "" > ./test-file-2.txt
          echo "{}" > ./test-file-2.json
          mkdir "test-dir"
          echo "" > ./test-dir/test-file-3.txt
          echo "{}" > ./test-dir/test-file-3.json

      - id: list
        uses: milaboratory/github-ci/actions/files/list@v4-beta
        with:
          relative: true
          patterns: |
            **/*.txt

    outputs:
      content: ${{ steps.list.outputs.paths }}

  check:
    runs-on: ubuntu-latest

    needs:
      - test-list-files

    steps:
      - uses: milaboratory/github-ci/actions/action-test@v1
        env:
          FILE_LIST_EXPECTED: |-
            ./test-dir/test-file-3.txt
            ./test-file.txt
            ./test-file-2.txt
          FILE_LIST_ACTUAL: ${{ needs.test-list-files.outputs.content }}

        with:
          test: |
            test_equals "List files" "${FILE_LIST_EXPECTED}" "${FILE_LIST_ACTUAL}"
